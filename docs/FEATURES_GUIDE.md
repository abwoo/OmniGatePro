# 🧩 OmniGate Pro 功能操作详解 (Features Guide)

本指南将带您深入了解 OmniGate Pro 的核心操作，包括技能调用、智能体管理以及 TUI 终端面板的使用。

---

## �‍💻 开发者视角：调用链路详解

对于想要进行二次开发或深入理解系统的开发者，OmniGate Pro 的运行逻辑如下：

### 1. 深度集成链路
当消息发生时，系统遵循以下“漏斗”模型：
1. **接入层**: OpenClaw 监听 Telegram Webhook。
2. **拦截层**: OmniGate 插件捕获上下文，执行 **Smart Shrinking** 算法。
3. **决策层**: DeepSeek 接收到压缩后的文本，决定调用哪个 `🧩 技能`。
4. **执行层**: 如果是本地技能，指令通过 **MCP 协议** 回传给 OmniGate 的 Python 进程执行。

### 2. 与 OpenClaw 开发的关系
- **共生关系**: OmniGate 依赖 OpenClaw 提供的强大社交渠道适配（Node.js 实现）。
- **能力补全**: OmniGate 利用 Python 的生态优势，为 OpenClaw 补全了复杂的本地自动化能力。
- **联调建议**: 建议开启两个终端，分别运行 `pnpm gateway:watch` (OpenClaw) 和 `omni run` (OmniGate)。

---

## �🛠️ 技能商店：AI 的“超能力”工具箱

您在终端面板看到的 `🧩 技能` 是给 AI 大脑（DeepSeek）使用的工具。

### 1. 如何触发技能？ (自然语言)
您无需输入命令，只需像平常一样聊天。
- **场景 A: 备忘录 (apple-notes)**
  - *您对 AI 说*: "把刚才聊的关于装修的想法存到我的苹果备忘录里。"
  - *AI 动作*: 自动调用 `apple-notes` 技能，在本地完成写入。
- **场景 B: 视觉工作区 (canvas)**
  - *您对 AI 说*: "帮我画一个 2024 年销量预测的柱状图。"
  - *AI 动作*: 自动启动 `canvas` 技能，在您的设备上弹出交互式图表。

### 2. 本地执行 vs 云端处理
- **隐私保护**: 涉及 `1password`、`apple-reminders` 等私人数据的技能，OmniGate Pro 会在您的本地设备上**静默执行**，绝不上传数据。
- **任务卸载**: 当 AI 需要运行代码或搜索本地文件时，它会将指令发给您的本地 OmniGate 插件完成。

## 💰 核心优势：智能 Token 节省 (Smart Shrinking)

OmniGate Pro 不仅仅是一个中转站，它更是您的“省钱管家”。

### 1. 语义级压缩算法
相比传统的简单截断，我们的 **v3.0 实体保持型压缩算法** 能够：
- **保留关键事实**: 自动识别并锁定对话中的路径、代码片段、API 密钥和特定指令。
- **分段摘要**: 将冗余的历史对话压缩为“语义事实链”，仅保留 10% 的长度却能让 AI 理解 90% 的背景。
- **动态优化**: 根据不同的 API 厂商（如 DeepSeek vs OpenAI）自动调整压缩策略。

### 2. 实时 Token 看板
在运行 `omni run` 进入仪表盘后，您可以实时查看到：
- **累计节省率**: 看到您的 API 账单是如何被砍掉 80% 以上的。
- **各厂商消耗明细**: 清楚地知道 DeepSeek 或 GPT-4 分别消耗了多少 Token。
- **使用场景追踪**: 标注 Token 是消耗在“聊天”还是“智能体思考”中。

---

## 🤖 智能体管理：多重身份切换

OmniGate 支持同时运行多个独立的 Agent，每个 Agent 可以有不同的“性格”和“模型”。

### 1. 配置多智能体
运行 `omni setup-advanced`，在“多智能体路由”中输入名称（如：`coding, life`）。

### 2. 路由逻辑
- **main (主智能体)**: 默认处理所有 Telegram/Discord 消息。
- **专业 Agent**: 您可以通过配置，让来自特定渠道（如 Slack）的消息只由 `coding` 智能体处理。

---

## 🩺 系统诊断：让配置“透明化” (Doctor Mode)

OmniGate Pro v3.0 引入了全新的**实时校验系统**，确保您的配置不仅是“写进去了”，而且是“生效了”。

### 1. 实时入驻校验 (Real-time Onboarding)
当您运行 `omni onboard` 时，系统不再只是默默地同步文件，而是会启动一个**实时进度条**：
- **配置文件同步**: 确认 `openclaw.json` 正确生成。
- **社交渠道心跳**: 实时模拟 Telegram 请求，验证 Bot Token 是否有效并显示机器人名称。
- **模型握手测试**: 依次连接 DeepSeek, OpenAI 等平台，测试 API Key 连通性并显示网络延迟。
- **插件环境扫描**: 验证本地 MCP 脚本和 Python 路径是否就绪。

### 2. 系统诊断中心 (omni doctor)
您可以随时通过主菜单选择 `🩺 系统诊断` 来进行深度检查：
- **渠道连通性**: 检查网络环境是否能正常访问 Telegram API。
- **服务可用性**: 实时获取各个 AI 厂商的响应状态。
- **系统资源监控**: 监控 CPU 和内存负载，预防由于资源不足导致的运行卡顿。

---

## 💻 TUI 终端仪表盘：实时监控

运行 `omni run` 即可进入全屏 TUI 面板。

### 1. 面板布局说明
- **🚀 系统状态**: 实时显示 CPU 和内存占用。如果占用过高，建议关闭不必要的本地技能。
- **💬 通讯渠道**: 显示 `Telegram`、`Discord` 等是否在线。
- **🧩 技能商店**: 实时列出当前已挂载的所有技能，让您知道 AI 现在的“能力边界”。

### 2. 交互操作
- **实时刷新**: 仪表盘每 0.5 秒自动更新一次。
- **优雅退出**: 按 `Ctrl + C` 即可退出仪表盘，返回主菜单，后台服务将继续运行。

---

## 🎙️ 进阶：语音与交互

### 1. Talk Mode (语音通话)
如果您配置了 ElevenLabs 密钥，您可以直接在手机 Telegram 上发送语音消息。
- AI 会识别您的语音。
- AI 会用您选定的音色（Voice ID）回传语音消息。

### 2. 视觉反馈 (Canvas)
当 AI 觉得文字说不清楚时，它会主动通过 Canvas 发送一个 URL 给您，打开后即可看到动态渲染的网页。

---
**提示**: 更多指令细节请参考 [COMMANDS.md](COMMANDS.md)。
